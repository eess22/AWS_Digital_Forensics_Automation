#  AWS 침해사고 포렌식 자동화 시스템

본 Workflow는 AWS EC2 환경에서 발생한 침해사고에 대해 **자동으로 감지 → 대응 → 포렌식 데이터 수집 및 분석**까지 일련의 절차를 자동화하는 시스템입니다.  
보안 담당자는 실시간 알림을 수신하고, 위협 인스턴스 격리 및 분석 결과를 자동으로 받아볼 수 있습니다.

---

##  개요

- **환경**: EC2가 AZ1, AZ2에 걸쳐 운영되며, Application Load Balancer(ALB)로 외부 사용자 접근을 수용
- **상황**: AZ2의 EC2 인스턴스가 침해되었고, 공격자는 웹 루트를 통해 명령어 삽입 공격을 감행
- **대응**: GuardDuty와 연동된 자동화 시스템이 침해 행위를 탐지하고, 포렌식 분석 및 대응 절차가 시작됨

---

##  아키텍처 흐름

<img width="770" alt="스크린샷 2025-05-21 23 46 20" src="https://github.com/user-attachments/assets/ddc01c6b-4cb3-4e7a-979a-d8653ea0499b" />


---

##  단계별 구성 설명

###  L1단계: 탐지 및 초기 대응

- **L1-1: 침해사고 알림**
  - SES(Simple Email Service)를 통해 보안 담당자에게 침해 사실 알림 발송
- **L1-2: IP 차단**
  - 공격자의 IP를 NACL(Network ACL)에 등록하여 차단
  - 동시에 악성 IP 목록에 기록 (`악성 IP Bucket` 저장)

---

###  L2 ~ L7단계: 포렌식 자동화

- **L1-3: 휘발성 데이터 수집**
  - 침해된 EC2 인스턴스에서 메모리, 네트워크 세션 등 휘발성 데이터 수집

- **L2: 휘발성 데이터 분석**
  - 수집된 휘발성 데이터를 분석하여 공격 흔적 식별

- **L3: 인스턴스 격리**
  - Security Group을 변경하여 외부 연결 차단

- **L4: 스냅샷 생성**
  - 해당 인스턴스의 EBS 볼륨을 스냅샷 생성하여 보존

- **L5: 비휘발성 데이터 수집**
  - 스냅샷을 마운트한 새로운 인스턴스에서 파일, 로그 등 비휘발성 데이터 추출

- **L6: 전체 데이터 분석**
  - 휘발성 + 비휘발성 데이터 통합 분석 및 증거 정리

- **L7: 결과 전송**
  - 분석 결과를 S3에 저장한 후 SES를 통해 담당자에게 전송
---

##  Lambda 함수 설명 (`forensic_workflow/lambda/`)

본 디렉터리는 AWS Step Functions와 연계되어 포렌식 자동화 과정의 각 단계를 수행하는 **Lambda 함수들**로 구성되어 있습니다.

| 파일명 | 역할 설명 |
|--------|-----------|
| `AddMaliciousIPToNACL.py` | 공격자로 추정되는 IP를 **NACL(Network ACL)**에 등록하여 트래픽 차단 |
| `CloudTrail_Lambda.py` | **CloudTrail 로그 이벤트**를 분석하여 이상 행위 여부를 확인 |
| `Forensic_Analysis.py` | 수집된 **휘발성 및 비휘발성 데이터 종합 분석**, 결과 생성 |
| `IsolatedInstance.py` | EC2 인스턴스의 **보안 그룹을 변경하여 네트워크 격리** 수행 |
| `Memory_Collect_1.py` | **휘발성 데이터 수집 - 프로세스, 연결 포트 등** 수집 |
| `Memory_Collect_2.py` | **추가 휘발성 정보 수집** (네트워크 세션, 사용자 세션 등) |
| `Non_Volatility_Collect.py` | 마운트된 볼륨에서 **비휘발성 데이터 수집** (파일, 로그 등) |
| `Snapshot.py` | 대상 EC2 인스턴스의 **EBS 스냅샷 생성** 및 신규 인스턴스에 **볼륨 마운트** 수행 |
| `sendEmailWithNotification.py` | **침해 탐지 알림 메일 발송** (L1-1 단계) |
| `sendEmailWithReport.py` | **포렌식 분석 결과 보고서 메일 전송** (L7 단계) |

---
